{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1><span class="material-icons">flight_takeoff</span> {{ airfield.icao_code }} - {{ airfield.name }}</h1>
    <div>
        <a href="{{ url_for('admin.edit_airfield', airfield_id=airfield.id) }}" class="btn btn-primary me-2">
            <span class="material-icons me-2">edit</span> Edit
        </a>
        <a href="{{ url_for('admin.airfields') }}" class="btn btn-outline-secondary">
            <span class="material-icons me-2">arrow_back</span> Back to List
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Airfield Information</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>ICAO Code:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge bg-primary fs-6">{{ airfield.icao_code }}</span>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Name:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ airfield.name }}
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Coordinates:</strong>
                    </div>
                    <div class="col-sm-9">
                        <code>{{ "%.6f"|format(airfield.latitude) }}, {{ "%.6f"|format(airfield.longitude) }}</code>
                        <br><small class="text-muted">Decimal degrees (WGS84)</small>
                    </div>
                </div>
                
                {% if airfield.country %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Country:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge bg-info">{{ airfield.country }}</span>
                    </div>
                </div>
                {% endif %}
                
                {% if airfield.region %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Region:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ airfield.region }}
                    </div>
                </div>
                {% endif %}
                
                {% if airfield.elevation_ft %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Elevation:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ airfield.elevation_ft }} ft
                        <small class="text-muted">({{ "%.0f"|format(airfield.elevation_ft * 0.3048) }} m)</small>
                    </div>
                </div>
                {% endif %}
                
                {% if airfield.source %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Source:</strong>
                    </div>
                    <div class="col-sm-9">
                        <span class="badge bg-secondary">{{ airfield.source }}</span>
                    </div>
                </div>
                {% endif %}
                
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Status:</strong>
                    </div>
                    <div class="col-sm-9">
                        {% if airfield.is_active %}
                            <span class="badge bg-success">Active</span>
                        {% else %}
                            <span class="badge bg-danger">Inactive</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Created:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ airfield.created_at.strftime(current_user.date_format + " %H:%M UTC") }}
                    </div>
                </div>
                
                {% if airfield.updated_at != airfield.created_at %}
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Last Updated:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ airfield.updated_at.strftime(current_user.date_format + " %H:%M UTC") }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if airfield.runway_info or airfield.frequencies %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Additional Information</h5>
            </div>
            <div class="card-body">
                {% if airfield.runway_info %}
                <div class="mb-3">
                    <strong>Runway Information:</strong>
                    <pre class="mt-2 bg-light p-2 rounded"><code>{{ airfield.runway_info }}</code></pre>
                </div>
                {% endif %}
                
                {% if airfield.frequencies %}
                <div class="mb-3">
                    <strong>Radio Frequencies:</strong>
                    <pre class="mt-2 bg-light p-2 rounded"><code>{{ airfield.frequencies }}</code></pre>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Map Location</h5>
            </div>
            <div class="card-body">
                <div id="airfield-map" style="height: 300px; width: 100%; border: 1px solid #dee2e6; border-radius: 0.375rem;"></div>
                <div class="mt-2 text-center">
                    <small class="text-muted">{{ "%.6f"|format(airfield.latitude) }}, {{ "%.6f"|format(airfield.longitude) }}</small>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('admin.edit_airfield', airfield_id=airfield.id) }}" class="btn btn-primary">
                        <span class="material-icons me-2">edit</span> Edit Airfield
                    </a>
                    
                    <form method="POST" action="{{ url_for('admin.delete_airfield', airfield_id=airfield.id) }}" class="mb-0">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="btn btn-danger w-100" onclick="return confirm('Are you sure you want to delete {{ airfield.icao_code }} - {{ airfield.name }}?\n\nThis action cannot be undone.')">
                            <span class="material-icons me-2">delete</span> Delete Airfield
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Quick Links</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="https://www.google.com/maps?q={{ airfield.latitude }},{{ airfield.longitude }}" target="_blank" class="btn btn-outline-primary">
                        <span class="material-icons me-2">map</span> Google Maps
                    </a>
                    <a href="https://skyvector.com/?ll={{ airfield.latitude }},{{ airfield.longitude }}&chart=301&zoom=4" target="_blank" class="btn btn-outline-primary">
                        <span class="material-icons me-2">flight</span> SkyVector
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e9ecef;
}

.page-header h1 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    color: #333;
}

pre code {
    background: none !important;
    padding: 0 !important;
}

/* Map specific styles */
#airfield-map {
    width: 100%;
    height: 300px;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
}
</style>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>

<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Airfield coordinates from the template
    var airfieldLat = {{ airfield.latitude }};
    var airfieldLng = {{ airfield.longitude }};
    var airfieldName = "{{ airfield.name|e }}";
    var airfieldIcao = "{{ airfield.icao_code|e }}";
    
    // Initialize the map
    var map = L.map('airfield-map').setView([airfieldLat, airfieldLng], 13);
    
    // Add OpenStreetMap tile layer
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    
    // Create custom icon for the airfield
    var airfieldIcon = L.divIcon({
        className: 'custom-airfield-marker',
        html: '<div style="background-color: #007bff; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"><span class="material-icons" style="font-size: 16px;">flight_takeoff</span></div>',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12]
    });
    
    // Add marker for the airfield
    var airfieldMarker = L.marker([airfieldLat, airfieldLng], {
        icon: airfieldIcon
    }).addTo(map);
    
    // Create popup content
    var popupContent = '<div style="text-align: center;">' +
        '<strong>' + airfieldIcao + '</strong><br>' +
        airfieldName + '<br>' +
        '<small class="text-muted">Lat: ' + airfieldLat.toFixed(6) + ', Lng: ' + airfieldLng.toFixed(6) + '</small>' +
        '</div>';
    
    airfieldMarker.bindPopup(popupContent);
    
    // Simple size invalidation after DOM is ready
    setTimeout(function() {
        map.invalidateSize();
    }, 100);
});
</script>

{% endblock %}
