{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1><span class="material-icons">add_location</span> New Airfield</h1>
    <div>
        <a href="{{ url_for('admin.airfields') }}" class="btn btn-outline-secondary">
            <span class="material-icons me-2">arrow_back</span> Back to List
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">New Airfield Information</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="icao_code" class="form-label">ICAO Code *</label>
                            <input type="text" class="form-control" id="icao_code" name="icao_code" 
                                   placeholder="e.g., LJLJ" maxlength="4" pattern="[A-Za-z]{4}" 
                                   style="text-transform: uppercase;" required>
                            <div class="form-text">Must be exactly 4 letters</div>
                        </div>
                        <div class="col-md-6">
                            <label for="name" class="form-label">Airport Name *</label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   placeholder="e.g., Ljubljana Airport" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="latitude" class="form-label">Latitude *</label>
                            <input type="number" class="form-control" id="latitude" name="latitude" 
                                   placeholder="e.g., 46.2237" step="any" min="-90" max="90" required>
                            <div class="form-text">Decimal degrees (-90 to 90)</div>
                        </div>
                        <div class="col-md-6">
                            <label for="longitude" class="form-label">Longitude *</label>
                            <input type="number" class="form-control" id="longitude" name="longitude" 
                                   placeholder="e.g., 14.4576" step="any" min="-180" max="180" required>
                            <div class="form-text">Decimal degrees (-180 to 180)</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="country" class="form-label">Country</label>
                            <input type="text" class="form-control" id="country" name="country" 
                                   placeholder="e.g., Slovenia">
                        </div>
                        <div class="col-md-6">
                            <label for="region" class="form-label">Region</label>
                            <input type="text" class="form-control" id="region" name="region" 
                                   placeholder="e.g., Central Europe">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="elevation_ft" class="form-label">Elevation (ft)</label>
                            <input type="number" class="form-control" id="elevation_ft" name="elevation_ft" 
                                   placeholder="e.g., 1273">
                            <div class="form-text">Elevation in feet above sea level</div>
                        </div>
                        <div class="col-md-6">
                            <label for="source" class="form-label">Source</label>
                            <input type="text" class="form-control" id="source" name="source" 
                                   placeholder="e.g., Manual Entry" value="Manual Entry">
                            <div class="form-text">Who or what loaded this airfield data</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="runway_info" class="form-label">Runway Information</label>
                        <textarea class="form-control" id="runway_info" name="runway_info" rows="3" 
                                  placeholder='{"runways": [{"designation": "31/13", "length_m": 3300, "width_m": 45, "surface": "Asphalt"}]}'></textarea>
                        <div class="form-text">JSON format runway data (optional)</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="frequencies" class="form-label">Radio Frequencies</label>
                        <textarea class="form-control" id="frequencies" name="frequencies" rows="3" 
                                  placeholder='{"tower": "118.100", "ground": "121.700", "approach": "119.100"}'></textarea>
                        <div class="form-text">JSON format frequency data (optional)</div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
                            <label class="form-check-label" for="is_active">
                                Active airfield
                            </label>
                            <div class="form-text">Inactive airfields are excluded from geocoding searches</div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-start gap-2">
                        <button type="submit" class="btn btn-primary">
                            <span class="material-icons me-2">add</span> Create Airfield
                        </button>
                        <a href="{{ url_for('admin.airfields') }}" class="btn btn-secondary">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Location Preview</h5>
            </div>
            <div class="card-body">
                <div id="preview-map" style="height: 250px; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; border: 1px solid #dee2e6; border-radius: 0.375rem;">
                    <div class="text-center">
                        <span class="material-icons" style="font-size: 3rem; color: #6c757d;">add_location</span>
                        <p class="text-muted mt-2" id="coords-display">Enter coordinates</p>
                        <small class="text-muted">Location will appear here</small>
                    </div>
                </div>
                
                <div class="mt-3" id="external-links" style="display: none;">
                    <h6>Verify Location:</h6>
                    <div class="d-grid gap-2">
                        <a href="#" id="google-maps-link" target="_blank" class="btn btn-outline-primary btn-sm">
                            <span class="material-icons me-1">map</span> Google Maps
                        </a>
                        <a href="#" id="skyvector-link" target="_blank" class="btn btn-outline-primary btn-sm">
                            <span class="material-icons me-1">flight</span> SkyVector
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Help</h5>
            </div>
            <div class="card-body">
                <h6>ICAO Code:</h6>
                <p class="small">International Civil Aviation Organization code - a unique 4-letter identifier for each airport worldwide.</p>
                
                <h6>Coordinates:</h6>
                <p class="small">Use decimal degrees format:</p>
                <ul class="small">
                    <li>Latitude: -90 to 90</li>
                    <li>Longitude: -180 to 180</li>
                    <li>Positive = North/East</li>
                    <li>Negative = South/West</li>
                </ul>
                
                <h6 class="mt-3">Examples:</h6>
                <ul class="small">
                    <li>LJLJ - Ljubljana, Slovenia</li>
                    <li>LOWW - Vienna, Austria</li>
                    <li>EDDF - Frankfurt, Germany</li>
                </ul>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Data Sources</h5>
            </div>
            <div class="card-body">
                <p class="small">Recommended external sources for airfield data:</p>
                <ul class="small">
                    <li><strong>OurAirports:</strong> Free airport database</li>
                    <li><strong>ICAO:</strong> Official aviation codes</li>
                    <li><strong>AIP:</strong> Aeronautical Information Publications</li>
                    <li><strong>OpenFlights:</strong> Open source flight database</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-uppercase ICAO code
document.getElementById('icao_code').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
});

// Update coordinate display and links when values change
document.getElementById('latitude').addEventListener('input', updateCoordinatesDisplay);
document.getElementById('longitude').addEventListener('input', updateCoordinatesDisplay);

function updateCoordinatesDisplay() {
    const lat = document.getElementById('latitude').value;
    const lon = document.getElementById('longitude').value;
    
    if (lat && lon) {
        const display = `${parseFloat(lat).toFixed(4)}, ${parseFloat(lon).toFixed(4)}`;
        document.getElementById('coords-display').textContent = display;
        
        // Update external links
        const googleLink = document.getElementById('google-maps-link');
        const skyVectorLink = document.getElementById('skyvector-link');
        
        googleLink.href = `https://www.google.com/maps?q=${lat},${lon}`;
        skyVectorLink.href = `https://skyvector.com/?ll=${lat},${lon}&chart=301&zoom=4`;
        
        document.getElementById('external-links').style.display = 'block';
    } else {
        document.getElementById('coords-display').textContent = 'Enter coordinates';
        document.getElementById('external-links').style.display = 'none';
    }
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const icaoCode = document.getElementById('icao_code').value.trim();
    const name = document.getElementById('name').value.trim();
    const lat = document.getElementById('latitude').value;
    const lon = document.getElementById('longitude').value;
    
    if (!icaoCode || icaoCode.length !== 4 || !/^[A-Z]{4}$/.test(icaoCode)) {
        e.preventDefault();
        alert('ICAO code must be exactly 4 letters.');
        return;
    }
    
    if (!name) {
        e.preventDefault();
        alert('Airport name is required.');
        return;
    }
    
    if (!lat || !lon) {
        e.preventDefault();
        alert('Both latitude and longitude are required.');
        return;
    }
    
    const latitude = parseFloat(lat);
    const longitude = parseFloat(lon);
    
    if (latitude < -90 || latitude > 90) {
        e.preventDefault();
        alert('Latitude must be between -90 and 90 degrees.');
        return;
    }
    
    if (longitude < -180 || longitude > 180) {
        e.preventDefault();
        alert('Longitude must be between -180 and 180 degrees.');
        return;
    }
});
</script>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e9ecef;
}

.page-header h1 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
    color: #333;
}

.form-label {
    font-weight: 600;
}

.card-header h5 {
    color: #333;
}

#icao_code {
    font-family: monospace;
    font-weight: bold;
}
</style>

{% endblock %}
